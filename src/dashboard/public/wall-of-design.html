<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Wall of Design</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      color-scheme: dark;
      --bg: #0b0d12;
      --bg-elevated: #151924;
      --card: #151924;
      --card-border: rgba(255, 255, 255, 0.08);
      --card-glow: rgba(123, 211, 255, 0.15);
      --text-primary: #f4f6fb;
      --text-muted: #a7b0c0;
      --accent: #7bd3ff;
      --accent-strong: #4f9bff;
      --placeholder: #1f2433;
      --shadow: 0 24px 60px rgba(0, 0, 0, 0.45);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Space Grotesk", "IBM Plex Sans", sans-serif;
      background: radial-gradient(circle at top left, rgba(123, 211, 255, 0.18), transparent 50%),
        radial-gradient(circle at 20% 80%, rgba(79, 155, 255, 0.2), transparent 55%),
        var(--bg);
      color: var(--text-primary);
    }

    .page {
      padding: 48px clamp(20px, 4vw, 64px) 72px;
      display: flex;
      flex-direction: column;
      gap: 32px;
    }

    .hero {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-width: 820px;
    }

    .hero-title {
      font-size: clamp(2rem, 1.4rem + 2vw, 3rem);
      margin: 0;
      letter-spacing: -0.02em;
    }

    .hero-subtitle {
      margin: 0;
      color: var(--text-muted);
      font-size: 1rem;
      line-height: 1.6;
    }

    .status {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 16px;
      border-radius: 999px;
      background: rgba(123, 211, 255, 0.12);
      color: var(--text-primary);
      font-weight: 600;
      font-size: 0.95rem;
    }

    .status[hidden] {
      display: none;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 24px;
    }

    .card {
      position: relative;
      display: flex;
      flex-direction: column;
      border-radius: 20px;
      overflow: hidden;
      background: linear-gradient(160deg, rgba(123, 211, 255, 0.06), transparent 40%), var(--card);
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow);
      min-height: 360px;
      animation: rise 0.6s ease forwards;
      opacity: 0;
      transform: translateY(20px);
    }

    .card::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 20px;
      border: 1px solid transparent;
      pointer-events: none;
      box-shadow: 0 0 40px var(--card-glow);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .card:hover::after {
      opacity: 1;
    }

    .thumb {
      position: relative;
      height: 220px;
      background: var(--placeholder);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .thumb-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      color: var(--text-muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      font-size: 0.7rem;
    }

    .thumb-placeholder span {
      font-size: 2.4rem;
      letter-spacing: 0;
      color: var(--accent);
    }

    .card-body {
      display: flex;
      flex-direction: column;
      gap: 14px;
      padding: 20px 20px 24px;
      flex: 1;
    }

    .meta {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .chip {
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.06);
      color: var(--text-primary);
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: capitalize;
    }

    .chip.muted {
      color: var(--text-muted);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 0.7rem;
    }

    .card-actions {
      margin-top: auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .preview-link {
      text-decoration: none;
      color: var(--text-primary);
      background: linear-gradient(130deg, var(--accent), var(--accent-strong));
      padding: 10px 16px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 0.9rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 12px 24px rgba(79, 155, 255, 0.25);
    }

    .preview-link:hover {
      transform: translateY(-1px) scale(1.02);
      box-shadow: 0 16px 30px rgba(79, 155, 255, 0.35);
    }

    .generated-at {
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    @keyframes rise {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 600px) {
      .page {
        padding: 32px 18px 56px;
      }

      .card {
        min-height: 320px;
      }
    }
  </style>
</head>
<body>
  <main class="page">
    <header class="hero">
      <h1 class="hero-title">Wall of Design</h1>
      <p class="hero-subtitle">A live grid of generated websites. Each card links to a demo preview with industry and vibe baked in.</p>
      <div id="status" class="status" hidden>Loading...</div>
    </header>

    <section id="designGrid" class="grid" aria-live="polite"></section>
  </main>

  <script>
    const grid = document.getElementById('designGrid');
    const status = document.getElementById('status');

    const statusMessages = {
      loading: 'Loading portfolio...',
      empty: 'Run swarm to generate sites',
    };

    function setStatus(message) {
      if (!message) {
        status.hidden = true;
        status.textContent = '';
        return;
      }
      status.hidden = false;
      status.textContent = message;
    }

    function safeString(value, fallback = '') {
      if (value === null || value === undefined) {
        return fallback;
      }
      const result = String(value).trim();
      return result || fallback;
    }

    function resolveAssetPath(pathValue) {
      if (typeof pathValue !== 'string') {
        return null;
      }
      const trimmed = pathValue.trim();
      if (!trimmed) {
        return null;
      }
      if (trimmed.startsWith('http://') || trimmed.startsWith('https://')) {
        return trimmed;
      }
      if (trimmed.startsWith('/')) {
        return trimmed;
      }
      if (trimmed.startsWith('dist/portfolio/')) {
        return `/portfolio/${trimmed.slice('dist/portfolio/'.length)}`;
      }
      if (trimmed.startsWith('portfolio/')) {
        return `/${trimmed}`;
      }
      return `/${trimmed}`;
    }

    function createPlaceholder() {
      const wrapper = document.createElement('div');
      wrapper.className = 'thumb';

      const placeholder = document.createElement('div');
      placeholder.className = 'thumb-placeholder';
      placeholder.innerHTML = '<span>[ ]</span>No Screenshot';

      wrapper.appendChild(placeholder);
      return wrapper;
    }

    function createImage(src, altText) {
      const wrapper = document.createElement('div');
      wrapper.className = 'thumb';

      const img = document.createElement('img');
      img.src = src;
      img.alt = altText;
      img.loading = 'lazy';

      wrapper.appendChild(img);
      return wrapper;
    }

    function formatLabel(value, fallback) {
      const label = safeString(value, fallback);
      return label.replace(/-/g, ' ');
    }

    function renderCards(entries) {
      grid.innerHTML = '';
      entries.forEach((entry, index) => {
        const industry = safeString(entry?.industry, 'unknown');
        const vibe = safeString(entry?.vibe, 'default');
        const previewUrl = `/demo/${encodeURIComponent(industry)}/${encodeURIComponent(vibe)}`;
        const imageSrc = resolveAssetPath(entry?.desktop);
        const generatedAt = safeString(entry?.generatedAt, '');

        const card = document.createElement('article');
        card.className = 'card';
        card.style.animationDelay = `${Math.min(index, 12) * 0.06}s`;

        const thumb = imageSrc
          ? createImage(imageSrc, `${formatLabel(industry, 'Industry')} ${formatLabel(vibe, 'Vibe')} preview`)
          : createPlaceholder();

        const body = document.createElement('div');
        body.className = 'card-body';

        const meta = document.createElement('div');
        meta.className = 'meta';

        const industryChip = document.createElement('div');
        industryChip.className = 'chip';
        industryChip.textContent = formatLabel(industry, 'Unknown');

        const vibeChip = document.createElement('div');
        vibeChip.className = 'chip muted';
        vibeChip.textContent = formatLabel(vibe, 'Vibe');

        meta.appendChild(industryChip);
        meta.appendChild(vibeChip);

        const actions = document.createElement('div');
        actions.className = 'card-actions';

        const preview = document.createElement('a');
        preview.className = 'preview-link';
        preview.href = previewUrl;
        preview.textContent = 'Live Preview';

        const timestamp = document.createElement('div');
        timestamp.className = 'generated-at';
        timestamp.textContent = generatedAt ? `Generated ${new Date(generatedAt).toLocaleString()}` : '';

        actions.appendChild(preview);
        actions.appendChild(timestamp);

        body.appendChild(meta);
        body.appendChild(actions);

        card.appendChild(thumb);
        card.appendChild(body);

        grid.appendChild(card);
      });
    }

    async function loadManifest() {
      setStatus(statusMessages.loading);
      try {
        const response = await fetch('/portfolio/manifest.json', { cache: 'no-store' });
        if (!response.ok) {
          throw new Error('Manifest not available');
        }
        const data = await response.json();
        if (!Array.isArray(data) || data.length === 0) {
          setStatus(statusMessages.empty);
          return;
        }
        renderCards(data);
        setStatus('');
      } catch (error) {
        setStatus(statusMessages.empty);
        console.warn('Wall of design manifest unavailable.', error);
      }
    }

    loadManifest();
  </script>
</body>
</html>
